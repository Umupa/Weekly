---
/**
 * ArticleTools - 文章工具栏
 * 主题切换按钮，使用简约东方美感图标
 */
---

<button
  type="button"
  class="theme-btn"
  id="theme-toggle"
  aria-label="切换主题"
  title="切换主题"
>
  <!-- 亮色：晴天云朵 - Lucide cloud-sun -->
  <svg class="icon icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 2v2"></path>
    <path d="m4.93 4.93 1.41 1.41"></path>
    <path d="M20 12h2"></path>
    <path d="m19.07 4.93-1.41 1.41"></path>
    <path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"></path>
    <path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"></path>
  </svg>

  <!-- 暗色：月 - 优雅弧月 -->
  <svg class="icon icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1Z" stroke-linejoin="round"></path>
    <circle cx="16" cy="6" r="1" fill="currentColor" stroke="none"></circle>
    <circle cx="19" cy="9" r="0.5" fill="currentColor" stroke="none"></circle>
  </svg>

  <!-- 纸张：墨砚 - 文人气质 -->
  <svg class="icon icon-paper" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <ellipse cx="12" cy="14" rx="8" ry="5" stroke-linejoin="round"></ellipse>
    <path d="M4 14v2c0 2.76 3.58 5 8 5s8-2.24 8-5v-2" stroke-linejoin="round"></path>
    <circle cx="12" cy="14" r="3" fill="currentColor" opacity="0.15"></circle>
    <path d="M15 5 9 11" stroke-linecap="round"></path>
    <path d="M16 4a1 1 0 0 1 0 2l-1.5 1" stroke-linecap="round" stroke-linejoin="round"></path>
  </svg>
</button>

<style>
  .theme-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s ease;
    flex-shrink: 0;
    vertical-align: middle;
  }

  .theme-btn:hover {
    color: var(--accent);
    background: var(--bg-secondary);
  }

  .icon {
    width: 20px;
    height: 20px;
    display: none;
  }

  :global([data-theme='light']) .icon-light,
  :global(:root:not([data-theme])) .icon-light {
    display: block;
  }

  :global([data-theme='dark']) .icon-dark {
    display: block;
  }

  :global([data-theme='paper']) .icon-paper {
    display: block;
  }
</style>

<script>
  const THEMES = ['light', 'dark', 'paper'] as const;
  type Theme = (typeof THEMES)[number];

  function getStoredTheme(): Theme | null {
    if (typeof localStorage !== 'undefined') {
      const stored = localStorage.getItem('theme');
      if (stored && THEMES.includes(stored as Theme)) {
        return stored as Theme;
      }
    }
    return null;
  }

  function setTheme(theme: Theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }

  function cycleTheme() {
    const current = document.documentElement.getAttribute('data-theme') as Theme || 'light';
    const currentIndex = THEMES.indexOf(current);
    const nextIndex = (currentIndex + 1) % THEMES.length;
    setTheme(THEMES[nextIndex]);
  }

  function init() {
    document.getElementById('theme-toggle')?.addEventListener('click', cycleTheme);
  }

  document.addEventListener('DOMContentLoaded', init);
  document.addEventListener('astro:page-load', init);

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!getStoredTheme()) {
      setTheme(e.matches ? 'dark' : 'light');
    }
  });
</script>
